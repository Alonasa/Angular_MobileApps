@if (recipe) {
  <app-header></app-header>
  <ion-content [fullscreen]="true">
    <ion-row class="ion-padding ion-align-items-center">
      <div class="recipe-wrapper">
        <div class="recipe-meta-overlay">
          <img src="{{recipe.image}}" alt="Photo of tasty {{recipe.title}}" width="556" height="370">
          <h1>{{ recipe.title }}</h1>
          <div>
            <ion-chip color="tertiary">
              <ion-icon name="time-outline"></ion-icon>
              <ion-label>{{ recipe.readyInMinutes }} mins</ion-label>
            </ion-chip>
            <ion-chip color="tertiary">
              <ion-icon name="people-outline"></ion-icon>
              <ion-label>{{ recipe.servings }} servings</ion-label>
            </ion-chip>
            <div class="diet-preferences">
              @if (recipe.diets) {
                <span>Diet: </span>
                @for (diet of recipe.diets; track $index) {
                  <ion-chip color="tertiary">
                    <ion-icon [name]="getDietIcon(diet)"></ion-icon>
                    <ion-label>{{ diet }}</ion-label>
                  </ion-chip>
                }
              }
            </div>
          </div>
        </div>
        <div>
          <h2>Ingredients in {{ selectedUnit.charAt(0).toUpperCase() + selectedUnit.slice(1) }}:</h2>
          <ul class="ingredients-lis">
            <ion-row class="ion-justify-content-center ion-align-items-end">
              @for (ingredient of recipe.extendedIngredients; track ingredient.id; let i = $index) {
                <ion-col size="6" size-md="4" size-lg="3">
                  <li class="recipe-wrapper">
                    <h5>
                      <b>{{ $index + 1 + "." }}</b>
                      @if (selectedUnit === "us") {
                        {{ ingredient.measures.us.amount }}
                        {{ ingredient.measures.us.unitShort }}
                        {{ ingredient.meta[0] ? ingredient.meta[0] : "" }}
                        {{ ingredient.name }}
                      } @else {
                        {{ ingredient.measures.metric.amount }}
                        {{ ingredient.measures.metric.unitShort }}
                        {{ ingredient.meta[0] ? ingredient.meta[0] : "" }}
                        {{ ingredient.name }}
                      }
                    </h5>
                  </li>
                  <img
                    [src]="ingredient.image ? 'https://img.spoonacular.com/ingredients_100x100/' + ingredient.image : 'assets/no_product.png'"
                    width="100"
                    height="100">
                </ion-col>
              }
            </ion-row>

          </ul>
          <div class="steps-container">
            <h2><b>Instructions:</b></h2>
            <ol>
              @for (step of recipe.analyzedInstructions[0].steps; track $index) {
                <li>{{ step.step }}</li>
              }
            </ol>
            <ion-button fill="outline" (click)="toggleFavorite(isFavorite)">
              <ion-icon slot="start" [name]="isFavorite ? 'heart' : 'heart-outline'"></ion-icon>
              @if (isFavorite) {
                Remove from favorites
              } @else {
                Add to favorites
              }
            </ion-button>
          </div>
        </div>
      </div>
    </ion-row>
  </ion-content>
} @else if (isLoading) {
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/home" [routerLink]="['/home']"></ion-back-button>
      </ion-buttons>
      <ion-title>No content</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <div class="recipe-wrapper">
      <ion-skeleton-text [animated]="isLoading"
                         style="width: 100%; height: 300px; border-radius: 12px;"></ion-skeleton-text>

      <!-- Title Skeleton -->
      <h1>
        <ion-skeleton-text [animated]="isLoading" style="width: 70%; margin: 20px auto;"></ion-skeleton-text>
      </h1>

      <!-- Chips Skeleton -->
      <div style="display: flex; justify-content: center; gap: 10px;">
        <ion-skeleton-text [animated]="isLoading"
                           style="width: 80px; height: 30px; border-radius: 16px;"></ion-skeleton-text>
        <ion-skeleton-text [animated]="isLoading"
                           style="width: 80px; height: 30px; border-radius: 16px;"></ion-skeleton-text>
      </div>

      <!-- Ingredients Grid Skeleton -->
      <div style="margin-top: 40px;">
        <ion-grid>
          <ion-row>
            @for (i of [1, 2, 3, 4, 5, 6]; track $index) {
              <ion-col size="6" size-md="4">
                <ion-skeleton-text [animated]="isLoading"
                                   style="width: 40px; height: 40px; border-radius: 50%; margin: 0 auto;"></ion-skeleton-text>
                <ion-skeleton-text [animated]="isLoading" style="width: 80%; margin: 10px auto;"></ion-skeleton-text>
              </ion-col>
            }
          </ion-row>
        </ion-grid>
      </div>
    </div>
  </ion-content>
} @else {
  <!-- Your error state -->
  <h1>Sorry something went wrong</h1>
}

